#include QMK_KEYBOARD_H

extern keymap_config_t keymap_config;

#define _QWERTY 0
#define _HIDEN 1
#define _COLEMAK 2
#define _LOWER 6
#define _RAISE 7
#define _EXTEND 8
#define _FUNC 9
#define _MOUSE 10
#define _ADJUST 11

enum custom_keycodes {
  QWERTY = SAFE_RANGE,
  LOWER,
  RAISE,
  ADJUST,
};

// #define KC_ KC_TRNS
#define _______ KC_TRNS
#define XXXXXXX KC_NO

// Tap-Hold keys
#define M_SPACE CTL_T(KC_SPC)
#define M_ENT SFT_T(KC_ENT)
#define M_LOWER LT(_LOWER, KC_ESC)
#define M_RAISE LT(_RAISE, KC_TAB)
#define M_ALT ALT_T(KC_BSPC)
#define M_D LT(_FUNC, KC_D)
#define M_F LT(_EXTEND, KC_F)
#define M_G LT(_MOUSE, KC_G)
#define L1_S LT(_FUNC, KC_S)
#define L1_T LT(_EXTEND, KC_T)
#define L1_D LT(_MOUSE, KC_D)

#define L_BASE NORMAL
#define L_HIDEN HIDEN
#define L_LOWER LT(_LOWER, KC_ESC)
#define L_RAISE LT(_RAISE, KC_BSPC)
#define L_FUNC MO(_FUNC)
#define L_ADJST MO(_ADJUST)

#define KC_RST RESET
#define KC_DBUG DEBUG
#define KC_RTOG RGB_TOG
#define KC_RMOD RGB_MOD
#define KC_RRMD RGB_RMOD
#define KC_RHUI RGB_HUI
#define KC_RHUD RGB_HUD
#define KC_RSAI RGB_SAI
#define KC_RSAD RGB_SAD
#define KC_RVAI RGB_VAI
#define KC_RVAD RGB_VAD

#define KC_L1   DF(_QWERTY)
#define KC_L2   DF(_HIDEN)
#define KC_L3   DF(_COLEMAK)

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

  [_QWERTY] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     KC_ESC  , KC_Q   , KC_W   , KC_E   , KC_R   , KC_T   , KC_L1  ,          KC_L2  , KC_Y   , KC_U   , KC_I   , KC_O   , KC_P   , KC_BSPC,
     KC_TAB  , KC_A   , KC_S   , M_D    , M_F    , M_G    , KC_L3  ,          XXXXXXX, KC_H   , KC_J   , KC_K   , KC_L   , KC_SCLN, KC_ENT ,
     KC_LALT , KC_Z   , KC_X   , KC_C   , KC_V   , KC_B   , XXXXXXX,          XXXXXXX, KC_N   , KC_M   , KC_COMM, KC_DOT , KC_SLSH, KC_APP ,
     ADJUST  , XXXXXXX, KC_DEL , KC_LGUI,          L_LOWER, M_SPACE,          M_ENT  , L_RAISE,          KC_LEFT, KC_RGHT, KC_DOWN, KC_UP
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_HIDEN] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , KC_Q   , KC_W   , KC_E   , KC_R   , KC_T   , _______,          _______, KC_Y   , KC_U   , KC_I   , KC_O   , KC_P   , _______,
     _______ , KC_A   , KC_S   , M_D    , M_F    , M_G    , _______,          _______, KC_H   , KC_J   , KC_K   , KC_L   , KC_SCLN, _______,
     _______ , KC_Z   , KC_X   , KC_C   , KC_V   , KC_B   , _______,          _______, KC_N   , KC_M   , KC_COMM, KC_DOT , KC_SLSH, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_COLEMAK] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , KC_Q   , KC_W   , KC_F   , KC_P   , KC_G   , _______,          _______, KC_J   , KC_L   , KC_U   , KC_Y   , KC_SCLN, _______,
     _______ , KC_A   , KC_R   , L1_S   , L1_T   , L1_D   , _______,          _______, KC_H   , KC_N   , KC_E   , KC_I   , KC_O   , _______,
     _______ , KC_Z   , KC_X   , KC_C   , KC_V   , KC_B   , _______,          _______, KC_K   , KC_M   , KC_COMM, KC_DOT , KC_SLSH, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [3] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [4] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [5] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_LOWER] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , KC_TILD, KC_BSLS, _______, _______, KC_TAB , _______,          _______, KC_QUOT, KC_DQT , KC_UNDS, KC_PIPE, KC_COLN, _______,
     _______ , KC_GRV , KC_EQL , KC_PLUS, KC_MINS, KC_APP , _______,          _______, KC_LBRC, KC_RBRC, KC_LCBR, KC_RCBR, KC_SCLN, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, KC_LPRN, KC_RPRN, KC_LABK, KC_RABK, KC_QUES, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_RAISE] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , KC_EXLM, KC_AT  , KC_HASH, KC_DLR , KC_PERC, _______,          _______, KC_CIRC, KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, _______,
     _______ , KC_1   , KC_2   , KC_3   , KC_4   , KC_5   , _______,          _______, KC_6   , KC_7   , KC_8   , KC_9   , KC_0   , _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_EXTEND] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , _______, _______, KC_ESC , _______, _______, _______,          _______, KC_COLN, KC_SCLN, KC_LABK, KC_RABK, KC_QUES, _______,
     _______ , _______, _______, KC_BSPC, _______, _______, _______,          _______, KC_ENT , KC_SPC , KC_COMM, KC_DOT , KC_SLSH, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_FUNC] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , KC_F1  , KC_F2  , KC_F3  , KC_F4  , KC_F5  , _______,          _______, KC_F6  , KC_F7  , KC_F8  , KC_F9  , KC_F10 , _______,
     _______ , KC_F11 , KC_F12 , _______, KC_HOME, KC_END , _______,          _______, KC_LEFT, KC_DOWN, KC_UP  , KC_RGHT, KC_PSCR, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, KC_PGUP, KC_PGDN, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_MOUSE] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     _______ , _______, _______, KC_ESC , _______, _______, _______,          _______, KC_BTN1, KC_BTN2, KC_BTN3, KC_BTN4, KC_BTN5, _______,
     _______ , _______, _______, KC_BSPC, _______, _______, _______,          _______, KC_MS_L, KC_MS_D, KC_MS_U, KC_MS_R, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, KC_WH_L, KC_WH_D, KC_WH_U, KC_WH_R, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  ),
  [_ADJUST] = LAYOUT(
  //,--------+--------+--------+--------+--------+--------+--------.        ,--------+--------+--------+--------+--------+--------+--------.
     RESET   , _______, KC_LCTL, KC_LALT, KC_DEL , _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______, _______, _______, _______,          _______, _______, _______, _______, _______, _______, _______,
     _______ , _______, _______, _______,          _______, _______,          _______, _______,          _______, _______, _______, _______
  //`--------+--------+--------+--------+--------+--------+--------/        \--------+--------+--------+--------+--------+--------+--------'
  )

};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
  switch (keycode) {
    case QWERTY:
      if (record->event.pressed) {
        #ifdef AUDIO_ENABLE
          PLAY_SONG(tone_qwerty);
        #endif
        set_single_persistent_default_layer(_QWERTY);
      }
      return false;
      break;
    case LOWER:
      if (record->event.pressed) {
        layer_on(_LOWER);
        update_tri_layer(_LOWER, _RAISE, _ADJUST);
      } else {
        layer_off(_LOWER);
        update_tri_layer(_LOWER, _RAISE, _ADJUST);
      }
      return false;
      break;
    case RAISE:
      if (record->event.pressed) {
        layer_on(_RAISE);
        update_tri_layer(_LOWER, _RAISE, _ADJUST);
      } else {
        layer_off(_RAISE);
        update_tri_layer(_LOWER, _RAISE, _ADJUST);
      }
      return false;
      break;
    case ADJUST:
      if (record->event.pressed) {
        layer_on(_ADJUST);
      } else {
        layer_off(_ADJUST);
      }
      return false;
      break;
  }
  return true;
}
